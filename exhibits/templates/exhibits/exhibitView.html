{% extends "calisphere/base.html,calisphere/pjaxTemplates/pjax-base.html"|pjax:request %}
{% load calisphere-extras %}
{% load markdown_filter %}

{% block page-metadata %}
{# {% include "calisphere/microdata.html" with title=item.title.0 description=item.description %} #}
{% endblock %}

{% block content %}

  <div class="modal fade" id="js-exhibit-item" tabindex="-1" role="dialog">
    <div class="modal-dialog" style="width: 100%;">
      <div class="modal-header" style="margin-bottom: 10px; border-bottom: 0">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="color: #fff; text-shadow: 0; opacity: 1" data-url="{{ exhibit.get_absolute_url }}"><span aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-content" style="border-radius: 0;">
        <div id="js-exhibit-item__container">
          {% block itemContent %}
          {% endblock %}
        </div>
      </div>
    </div>
  </div>

  <nav aria-label="breadcrumb" role="navigation">
    <span id="exhibit__breadcrumb-label"><a href="{% url 'exhibits:exhibitDirectory' %}" data-pjax="js-pageContent">Exhibitions</a></span>
    {% if relatedExhibitsByTheme|length > 0 %}
      <ol id="exhibit__breadcrumb" aria-labelledby="exhibit__breadcrumb-label">
        <li><a href="{{ relatedExhibitsByTheme.0.0.get_absolute_url }}" aria-level="1" data-pjax="js-pageContent">{{ relatedExhibitsByTheme.0.0 }}</a></li>
      </ol>
    {% endif %}
  </nav>
  
  <h1 class="exhibit__header" id="js-exhibit-title" data-slug="{{ exhibit.slug }}">{{ exhibit.title }}</h1>
  
  <div class="exhibit__hero" style="background-image: url('{{ exhibitMedia }}{{ exhibit.hero }}')">
    <div class="col-sm-6">
      {% if exhibit.blockquote %}<blockquote class="exhibit__blockquote">{{ exhibit.blockquote }} <a href="#overview">Read full overview</a></blockquote>{% endif %}
    </div>
  </div>


  <div class="exhibit__items">
    <h2 class="exhibit__items-header">{{ exhibitItems|length }} exhibition items</h2>{% if exhibitItems|length > 12 %}<a href="javascript: void(0)" class="js-show-all-exhibit-items">View all</a>{% endif %}
    
    <div class="row thumbnail">

      {% for item in exhibitItems %}
          <div class="col-xs-6 col-sm-3 col-md-2">
            {% with item.solrData as exhibitItemData %}
            {% if exhibitItemData %}
            <a class="thumbnail__link js-exhibit-item" href="{% url 'exhibits:itemView' exhibit.id item.item_id %}" title="{{ exhibitItemData.title }}">
            {% else %}
            <a class="thumbnail__link" href="http://content.cdlib.org/{{ item.item_id }}" data-toggle="tooltip" title="">
            {% endif %}
                {% if exhibitItemData %}
                  <div class="thumbnail__container">
                  {% if exhibitItemData.reference_image_md5 %}
                    <img class="thumbnail__image"
                    src="{{ thumbnailUrl }}crop/210x210/{{ exhibitItemData.reference_image_md5 }}"
                    srcset="{{ thumbnailUrl }}crop/210x210/{{ exhibitItemData.reference_image_md5 }} 60w, {{ thumbnailUrl }}crop/310x310/{{ exhibitItemData.reference_image_md5 }} 50w"
                    sizes="100vw"
                    alt="{{ exhibitItemData.title.0|truncatewords:12 }}">
                    {% if exhibitItemData.type_ss.0|lower == "moving image" %}
                    <div class="thumbnail__overlay-icon fa-video-camera"></div>
                    {% elif exhibitItemData.type_ss.0|lower == "sound"%}
                    <div class="thumbnail__overlay-icon fa-volume-up"></div>
                    {# elif exhibitItemData.type_ss.0|lower == "text" #}
                    <!-- <div class="thumbnail__overlay-icon fa-file-text-o"></div> -->
                    {% elif exhibitItemData.type_ss.0|lower == "dataset" %}
                    <div class="thumbnail__overlay-icon fa-bar-chart"></div>
                    {% endif %}
                  {% else %}
                    {% if exhibitItemData.type_ss.0|lower == "moving image" %}
                    <div class="thumbnail__tile-icon fa-video-camera"></div>
                    {% elif exhibitItemData.type_ss.0|lower == "sound"%}
                    <div class="thumbnail__tile-icon fa-volume-up"></div>
                    {% elif exhibitItemData.type_ss.0|lower == "text"%}
                    <div class="thumbnail__tile-icon fa-file-text-o"></div>
                    {% elif exhibitItemData.type_ss.0|lower == "dataset" %}
                    <div class="thumbnail__tile-icon fa-bar-chart"></div>
                    {% elif exhibitItemData.type_ss.0|lower == "image" %}
                    <div class="thumbnail__tile-icon fa-picture-o"></div>
                    {% endif %}
                  {% endif %}
                {% else %}
                  <div style="display: block; position: relative; background-color: #e5e5e5;">
                  {{ item.item_id }} not in Calisphere solr index
                {% endif %}
              </div>
            </a>
          </div>

        {% if forloop.counter == 12 %}
          <div class="js-exhibit-items-overflow hidden-content">
        {% endif %}

      {% endwith %}
      {% endfor %}
      {% if exhibitItems|length > 12 %}
        </div>
      {% endif %}
      
    </div>
    
    <div class="row text-right">
      {% if exhibitItems|length > 12 %}
        <a href="javascript: void(0)" class="js-show-all-exhibit-items">View all</a>
      {% endif %}
    </div>
  </div>
  
  <div class="row">
    <div class="col-sm-6">
      <div class="exhibit__overview" id="overview">
        {% include "exhibits/render_as.html" with render_as=exhibit.render_as text=exhibit.overview truncate=True container_class="js-exhibit__overview" %}
      </div>
    </div>
    <div class="col-sm-6">
      <div class="exhibit__notes">
        {% for note in exhibit.notesitem_set.all %}
          <div class="exhibit__note">
            <h3>{{ note.title }}</h3>
            {% include "exhibits/render_as.html" with render_as=note.render_as text=note.essay truncate=False container_class="" %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  {% if exhibit.byline %}
  <div class="row">
    <h2>About this exhibition:</h2>
    {% include "exhibits/render_as.html" with render_as=exhibit.byline_render_as text=exhibit.byline truncate=False container_class="" %}
  </div>
  {% endif %}

  <div class="exhibit__related-materials">
    {% for theme, exhibits in relatedExhibitsByTheme %}
      <h3>Explore more exhibitions in "<a href="{{ theme.get_absolute_url }}">{{ theme }}</a>" ({{ exhibits|length }})</h3>
      <div class="row js-related-carousel exhibit__related-carousel">
        {% for exhibit in exhibits %}
          <div class="col-xs-2 col-md-3">
            <a href="{{ exhibit.exhibit.get_absolute_url }}" data-pjax="js-pageContent">
              <div class="exhibit__lockup--small">
                <div class="aspect-ratio-content exhibit__lockup--small-image" style="background-image: url({{ exhibitMedia }}{{ exhibit.exhibit.hero }});">
                  <div class="exhibit__lockup--small-title">{{ exhibit.exhibit }}</div>
                </div>
              </div>
            </a>
          </div>
        {% endfor %}
      </div>
    {% endfor %}
    
    <h3>Read related essays ({{ exhibit.historicalessayexhibit_set.all|length }})</h3>
    <div class="row js-related-carousel exhibit__related-carousel">
      {% for hee in exhibit.historicalessayexhibit_set.all %}
        <div class="col-xs-2 col-md-3">
          <a href="{{ hee.historicalEssay.get_absolute_url }}">
            <div class="exhibit__essay-lockup">
              <div class="aspect-ratio-content exhibit__essay-lockup-image" style="background-image: url({{ exhibitMedia }}{{ hee.historicalEssay.hero }});">
                <div class="exhibit__essay-lockup-title">{{ hee.historicalEssay.title }}</div>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>

    <h3>Just for teachers: lesson plans ({{ exhibit.lessonplanexhibit_set.all|length }})</h3>
    <div class="row js-related-carousel exhibit__related-carousel">
      {% for lpe in exhibit.lessonplanexhibit_set.all %}
        <div class="col-xs-2 col-md-3">
          <a href="{{ lpe.lessonPlan.get_absolute_url }}">
            <div class="exhibit__lesson-lockup">
              <div class="aspect-ratio-content exhibit__lesson-lockup-image" style="background-image: url({{ exhibitMedia }}{{ lpe.lessonPlan.hero }});">
                <div class="exhibit__lesson-lockup-title">{{ lpe.lessonPlan.title }}</div>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  </div>

{% endblock %}

{% block footerScripts %}
<script>
  
  $('#js-exhibit__overview').click(function() {
    if ($('.js-exhibit__overview--full').is(':visible')) {
      $('.js-exhibit__overview--preview').show();
      $('.js-exhibit__overview--full').slideUp();
      $('#js-exhibit__overview').text('Read full exhibition overview.');
    } else {
      $('.js-exhibit__overview--full').slideDown();
      $('.js-exhibit__overview--preview').hide();
      $('#js-exhibit__overview').text('Read less');
    }
  });
  
  $('.js-show-all-exhibit-items').click(function() {
    $('.js-exhibit-items-overflow').slideToggle();
    if ($(this).text() == 'View all') {
      $(this).text('View fewer');
    } else {
      $(this).text('View all');
    }
  });
  
  $('.js-related-carousel').slick({
    infinite: false,
    slidesToShow: 4,
    slidesToScroll: 1,
    responsive: [
      {
        breakpoint: 900,
        settings: {
          slidesToShow: 3
        }
      },
      {
        breakpoint: 650,
        settings: {
          slidesToShow: 2
        }
      }
    ]
  });
</script>

{% endblock %}
